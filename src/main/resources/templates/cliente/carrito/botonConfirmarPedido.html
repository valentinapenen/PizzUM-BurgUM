<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirmar pedido - PizzUM &amp; BurgUM</title>

    <!-- CSS fondo/header/footer -->
    <link rel="stylesheet"
          href="../../../static/css/background-header-footer.css"
          th:href="@{/css/background-header-footer.css}">

    <!-- CSS del panel de cliente -->
    <link rel="stylesheet"
          href="../../../static/css/cliente/paneles-cliente.css"
          th:href="@{/css/cliente/paneles-cliente.css}">

    <style>
        .confirmacion-contenido {
            max-width: 900px;
            margin: 40px auto 80px auto;
            padding: 24px;
            border-radius: 24px;
            background: rgba(20, 20, 20, 0.75);
            backdrop-filter: blur(8px);
            color: #fff;
        }

        .confirmacion-titulo {
            font-family: "Bebas Neue", sans-serif;
            font-size: 2.2rem;
            margin-bottom: 8px;
        }

        .confirmacion-sub {
            font-size: 0.95rem;
            opacity: 0.85;
            margin-bottom: 18px;
        }

        .mensaje-error {
            margin-bottom: 12px;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 0.9rem;
            background: rgba(200, 40, 40, 0.12);
            border: 1px solid rgba(200, 40, 40, 0.65);
        }

        .resumen-carrito {
            margin-bottom: 18px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.12);
            padding-bottom: 12px;
        }

        .resumen-carrito h2 {
            font-size: 1.15rem;
            margin-bottom: 6px;
        }

        .resumen-carrito ul {
            margin: 0;
            padding-left: 18px;
            font-size: 0.9rem;
        }

        .resumen-carrito li {
            margin-bottom: 2px;
        }

        .resumen-total {
            margin-top: 6px;
            font-weight: 700;
            font-size: 1rem;
        }

        .form-confirmar {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-top: 12px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .form-group label {
            font-size: 0.95rem;
        }

        .form-group select {
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.45);
            padding: 8px 14px;
            background: rgba(0, 0, 0, 0.25);
            color: #fff;
            outline: none;
        }

        .form-group select option {
            color: #000;
        }

        .ayuda {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .form-actions {
            margin-top: 14px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .btn-principal,
        .btn-secundario {
            border-radius: 999px;
            padding: 8px 18px;
            font-size: 0.95rem;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: none;
        }

        .btn-principal {
            background: #ff7a2f;
            color: #fff;
            font-weight: 600;
        }

        .btn-secundario {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: #fff;
        }

        .btn-principal:hover,
        .btn-secundario:hover {
            filter: brightness(1.08);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px;
        }

        .bloque-aviso {
            margin-top: 10px;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 14px;
            padding: 10px 12px;
        }
    </style>
</head>
<body>

<header>
    <div class="header-brand">
        <img class="logo" alt="PizzUM & BurgUM logo" src="../../../static/images/logo.png" />
        <h1 class="brand-title">PizzUM &amp; BurgUM</h1>
    </div>

    <nav class="nav-bar">
        <a href="../inicio-cliente.html"
           th:href="@{/cliente/home}">
            Inicio
        </a>

        <a href="../creaciones/CreacionesPrincipalMenu.html"
           th:href="@{/cliente/hacer-creacion}">
            Crear
        </a>

        <a class="active"
           href="../carrito/lista.html"
           th:href="@{/cliente/carrito}">
            Carrito
        </a>

        <a href="../favoritos/lista.html"
           th:href="@{/cliente/favoritos}">
            Favoritos
        </a>

        <a href="../historial/lista.html"
           th:href="@{/cliente/historial}">
            Historial
        </a>

        <a href="../perfil.html"
           th:href="@{/cliente/perfil}">
            Perfil
        </a>
    </nav>
</header>

<main>
    <section class="confirmacion-contenido">

        <h1 class="confirmacion-titulo">Confirmar pedido</h1>
        <p class="confirmacion-sub">
            Elegí el domicilio de entrega y la tarjeta con la que querés pagar.
        </p>

        <!-- Mensaje de error que viene del POST /carrito/confirmar -->
        <div th:if="${error}" class="mensaje-error" th:text="${error}"></div>

        <!-- Resumen del carrito -->
        <div class="resumen-carrito">
            <h2>Resumen de tus creaciones</h2>

            <ul>
                <li th:each="c : ${creaciones}">
                    <span th:text="${c.tipo}">PIZZA</span>
                    -
                    $ <span th:text="${#numbers.formatDecimal(c.precioTotal,1,2)}">0.00</span>
                </li>
            </ul>

            <p class="resumen-total">
                Total aproximado:
                $ <span th:text="${#numbers.formatDecimal(totalCarrito,1,2)}">0.00</span>
            </p>
        </div>

        <!-- Si falta domicilio o tarjeta, mostramos aviso y no el form -->
        <div class="bloque-aviso"
             th:if="${#lists.isEmpty(domicilios)} or ${#lists.isEmpty(tarjetas)}">
            <p>
                Para confirmar el pedido necesitás tener al menos
                <strong>un domicilio</strong> y <strong>una tarjeta</strong> guardados.
            </p>
            <p class="ayuda">
                Podés agregarlos desde tu perfil, en las secciones de domicilio y tarjeta.
            </p>

            <div class="form-actions">
                <a class="btn-secundario"
                   href="lista.html"
                   th:href="@{/cliente/carrito}">
                    Volver al carrito
                </a>

                <a class="btn-principal"
                   href="../perfil.html"
                   th:href="@{/cliente/perfil}">
                    Ir a mi perfil
                </a>
            </div>
        </div>

        <!-- Formulario solo si hay al menos 1 domicilio y 1 tarjeta -->
        <form class="form-confirmar"
              th:if="${!#lists.isEmpty(domicilios)} and ${!#lists.isEmpty(tarjetas)}"
              action="botonConfirmarPedido.html"
              th:action="@{/cliente/carrito/confirmar}"
              method="post">

            <div class="grid-2">
                <!-- Domicilio -->
                <div class="form-group">
                    <label for="domicilioId">Domicilio de entrega</label>
                    <select id="domicilioId" name="domicilioId" required>
                        <option value="" disabled selected>Seleccionar domicilio...</option>
                        <option th:each="dom : ${domicilios}"
                                th:value="${dom.id}"
                                th:text="${dom.calle + ' ' + dom.numero + ' - ' + dom.ciudad}">
                        </option>
                    </select>
                    <span class="ayuda">
                        Elegí a dónde enviamos tu pedido.
                    </span>
                </div>

                <!-- Tarjeta -->
                <div class="form-group">
                    <label for="tarjetaId">Tarjeta</label>
                    <select id="tarjetaId" name="tarjetaId" required>
                        <option value="" disabled selected>Seleccionar tarjeta...</option>
                        <option th:each="tar : ${tarjetas}"
                                th:value="${tar.id}"
                                th:text="${tar.numero + ' - ' + tar.nombreTitular}">
                        </option>
                    </select>
                    <span class="ayuda">
                        Se usará esta tarjeta para el cobro.
                    </span>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-principal">
                    Confirmar pedido
                </button>

                <a class="btn-secundario"
                   href="lista.html"
                   th:href="@{/cliente/carrito}">
                    Volver al carrito
                </a>
            </div>
        </form>

    </section>
</main>

<footer class="footer">
    <div class="footer-brand">
        <img class="logo" alt="PizzUM & BurgUM logo" src="/images/logo.png" />
        <strong class="footer__title">PizzUM &amp; BurgUM</strong>
    </div>
    <small>© 2025 — Todos los derechos reservados</small>
</footer>

</body>
</html>
