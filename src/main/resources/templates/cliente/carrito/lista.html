<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito - PizzUM &amp; BurgUM</title>

    <!-- Auto-refresh solo si hay pedido en curso -->
    <meta http-equiv="refresh" content="10" th:if="${tienePedidoEnCurso}"/>

    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Lato:wght@300;400;700&display=swap"
          rel="stylesheet">

    <!-- CSS fondo/header/footer -->
    <link rel="stylesheet"
          href="../../../static/css/background-header-footer.css"
          th:href="@{/css/background-header-footer.css}">

    <!-- CSS de panel cliente -->
    <link rel="stylesheet"
          href="../../../static/css/cliente/paneles-cliente.css"
          th:href="@{/css/paneles-cliente.css}">

    <!-- CSS extra para carrito -->
    <style>
        .carrito-contenido {
            max-width: 1000px;
            margin: 40px auto 80px auto;
            padding: 24px;
            border-radius: 24px;
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(8px);
        }

        .carrito-titulo {
            font-family: "Bebas Neue", sans-serif;
            font-size: 2.2rem;
            margin-bottom: 16px;
            color: #ffffff;
        }

        .tabla-carrito {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            margin-bottom: 16px;
        }

        .tabla-carrito th,
        .tabla-carrito td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            font-size: 0.95rem;
        }

        .tabla-carrito th {
            text-align: left;
            font-weight: 600;
        }

        .tabla-carrito td ul {
            padding-left: 18px;
            margin: 0;
        }

        .precio {
            white-space: nowrap;
        }

        .mensaje-exito,
        .mensaje-error {
            margin-bottom: 12px;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 0.9rem;
        }

        .mensaje-exito {
            background: rgba(0, 180, 90, 0.1);
            border: 1px solid rgba(0, 180, 90, 0.6);
        }

        .mensaje-error {
            background: rgba(200, 40, 40, 0.1);
            border: 1px solid rgba(200, 40, 40, 0.6);
        }

        .btn-accion {
            border: none;
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 0.85rem;
            cursor: pointer;
            background: #ff4b4b;
            color: #fff;
        }

        .btn-accion:hover {
            filter: brightness(1.1);
        }

        .carrito-resumen {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .carrito-total {
            font-weight: 700;
            font-size: 1rem;
        }

        .carrito-botones {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 4px;
        }

        .btn-principal,
        .btn-secundario {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 18px;
            border-radius: 999px;
            font-size: 0.95rem;
            text-decoration: none;
            border: none;
            cursor: pointer;
        }

        .btn-principal {
            background: #ff7a2f;
            color: #fff;
        }

        .btn-secundario {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: #fff;
        }

        .btn-principal:hover,
        .btn-secundario:hover {
            filter: brightness(1.1);
        }

        .texto-vacio {
            font-size: 0.95rem;
            opacity: 0.8;
        }
    </style>
</head>
<body>

<header>
    <div class="header-brand">
        <img class="logo" alt="PizzUM & BurgUM logo" src="../../../static/images/logo.png" />
        <h1 class="brand-title">PizzUM & BurgUM</h1>
    </div>

    <nav class="nav-bar">

        <!-- Inicio -->
        <a href="../inicio-cliente.html"
           th:href="@{/cliente/home}">
            Inicio
        </a>

        <!-- Crear -->
        <a href="../creaciones/CreacionesPrincipalMenu.html"
           th:href="@{/cliente/hacer-creacion}">
            Crear
        </a>

        <!-- Carrito (activo) -->
        <a class="active"
           href="../carrito/lista.html"
           th:href="@{/cliente/carrito}">
            Carrito
        </a>

        <!-- Favoritos -->
        <a href="../favoritos/lista.html"
           th:href="@{/cliente/favoritos}">
            Favoritos
        </a>

        <!-- Historial -->
        <a href="../historial/lista.html"
           th:href="@{/cliente/historial}">
            Historial
        </a>

        <!-- Perfil -->
        <a href="../perfil.html"
           th:href="@{/cliente/perfil}">
            Perfil
        </a>

    </nav>
</header>

<main>
    <section class="carrito-contenido">

        <h1 class="carrito-titulo">Tu carrito</h1>

        <!-- Mensajes flash -->
        <div th:if="${exito}" class="mensaje-exito" th:text="${exito}"></div>
        <div th:if="${error}" class="mensaje-error" th:text="${error}"></div>

        <!-- Si no hay creaciones -->
        <p class="texto-vacio" th:if="${#lists.isEmpty(creaciones)}">
            Por ahora no tenés creaciones en tu carrito.
        </p>

        <!-- Lista de creaciones -->
        <table class="tabla-carrito" th:if="${!#lists.isEmpty(creaciones)}">
            <thead>
            <tr>
                <th>Tipo</th>
                <th>Detalle</th>
                <th>Favorito</th>
                <th>Precio</th>
                <th>Acciones</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="creacion : ${creaciones}">
                <td th:text="${creacion.tipo}">PIZZA</td>

                <td>
                    <ul>
                        <li th:each="prod : ${creacion.productos}"
                            th:text="${prod.nombre + ' (' + prod.tipo + ')'}">
                            Masa clásica (MASA)
                        </li>
                    </ul>
                </td>

                <td th:text="${creacion.favorito ? 'Sí' : 'No'}">No</td>

                <td class="precio">
                    $ <span th:text="${#numbers.formatDecimal(creacion.precioTotal,1,2)}">0.00</span>
                </td>

                <td>
                    <!-- Eliminar del carrito -->
                    <form th:action="@{/cliente/carrito/eliminar/{idCreacion}(idCreacion=${creacion.id})}"
                          method="post"
                          style="display: inline;">
                        <button type="submit" class="btn-accion">Eliminar</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- Resumen y botones -->
        <div class="carrito-resumen" th:if="${!#lists.isEmpty(creaciones)}">
            <p class="carrito-total">
                Total aproximado:
                $ <span th:text="${#numbers.formatDecimal(totalCarrito,1,2)}">0.00</span>
            </p>

            <div class="carrito-botones">
                <!-- Si HAY pedido en curso: botón de seguimiento -->
                <div th:if="${tienePedidoEnCurso}">
                    <a class="btn-principal"
                       href="botonSeguimientoPedido.html"
                       th:href="@{/cliente/pedido/seguimiento/{id}(id=${pedidoEnCurso.idPedido})}">
                        Ver seguimiento del pedido
                    </a>
                </div>









                <!-- Si NO hay pedido en curso: botón de continuar compra -->
                <div th:if="${!tienePedidoEnCurso}">
                    <a class="btn-principal"
                       href="botonConfirmarPedido.html"
                       th:href="@{/cliente/carrito/continuar}">
                        Continuar compra
                    </a>
                </div>

                <!-- Botón para volver a crear más cosas -->
                <a class="btn-secundario"
                   href="../creaciones/CreacionesPrincipalMenu.html"
                   th:href="@{/cliente/hacer-creacion}">
                    Seguir creando
                </a>
            </div>
        </div>

    </section>
</main>

<footer class="footer">
    <div class="footer-brand">
        <img class="logo" alt="PizzUM & BurgUM logo" src="/images/logo.png" />
        <strong class="footer__title">PizzUM &amp; BurgUM</strong>
    </div>
    <small>© 2025 — Todos los derechos reservados</small>
</footer>

</body>
</html>
