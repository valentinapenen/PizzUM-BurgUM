<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Seguimiento del pedido - PizzUM & BurgUM</title>
    <!-- Recargar cada 5 segundos para actualizar estado solo mientras no esté ENTREGADO -->
    <meta http-equiv="refresh" content="5" th:if="${pedido.estado.name() != 'ENTREGADO'}">
    <link rel="stylesheet" href="../../../static/css/background-header-footer.css" th:href="@{/css/background-header-footer.css}">
    <link rel="stylesheet" href="../../../static/css/cliente/paneles-cliente.css" th:href="@{/css/cliente/paneles-cliente.css}">
    <link rel="stylesheet" href="../../../static/css/cliente/seguimiento-pedido.css" th:href="@{/css/cliente/seguimiento-pedido.css}">
    <style>
        .alert { padding: 10px; border-radius: 6px; margin: 8px 0; }
        .alert-success { background: #e6ffed; color: #056b27; border: 1px solid #8de1a8; }
        .alert-danger { background: #ffe6e6; color: #8a0910; border: 1px solid #f3a3a7; }
        .btn-cancelar { background: #b00020; color: #fff; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; }
        .btn-cancelar:hover { background: #93001a; }
    </style>
    
</head>
<body>

<header>
    <div class="header-brand">
        <img class="logo" alt="PizzUM & BurgUM logo" src="/images/logo.png" />
        <h1 class="brand-title">PizzUM & BurgUM</h1>
    </div>
    <nav class="nav-bar">
        <a href="../inicio-cliente.html" th:href="@{/cliente/home}">Inicio</a>
        <a href="../creaciones/CreacionesPrincipalMenu.html" th:href="@{/cliente/hacer-creacion}">Crear</a>
        <a class="active" href="../carrito/lista.html" th:href="@{/cliente/carrito}">Carrito</a>
        <a href="../favoritos/lista.html" th:href="@{/cliente/favoritos}">Favoritos</a>
        <a href="../historial/lista.html" th:href="@{/cliente/historial}">Historial</a>
        <a href="../perfil.html" th:href="@{/cliente/perfil}">Perfil</a>
        <form th:action="@{/logout}" method="post">
            <button type="submit" class="nav-link">Cerrar sesión</button>
        </form>
    </nav>
    </header>

<main>
    <section class="seguimiento-box">
        <h1>Seguimiento del pedido</h1>

        <p>
            Pedido N° <strong th:text="${pedido.idPedido}">12</strong>
        </p>

        <p>
            Estado actual:
            <strong th:text="${pedido.estado}">EN_PREPARACION</strong>
        </p>

        <!-- Mensaje final cuando el pedido fue entregado -->
        <div th:if="${pedido.estado.name() == 'ENTREGADO'}" class="alert alert-success">
            ¡Tu pedido fue entregado! El seguimiento ha finalizado.
        </div>

        <!-- Mensajes flash -->
        <div th:if="${exito}" class="alert alert-success" th:text="${exito}"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <!-- Botón cancelar pedido: sólo si el estado es EN_COLA -->
        <form th:if="${pedido.estado.name() == 'EN_COLA'}"
              th:action="@{'/cliente/pedido/' + ${pedido.idPedido} + '/cancelar'}"
              method="post"
              style="margin-bottom: 16px;">
            <button type="submit" class="btn-cancelar" onclick="return confirm('¿Seguro que querés cancelar el pedido?');">
                Cancelar pedido
            </button>
        </form>

        <a class="btn-volver"
           href="lista.html"
           th:href="@{/cliente/carrito}">
            Volver al carrito
        </a>
    </section>
</main>

<footer class="footer">
    <div class="footer-brand">
        <img class="logo" alt="PizzUM & BurgUM logo" src="/images/logo.png" />
        <strong class="footer__title">PizzUM & BurgUM</strong>
    </div>
    <small>© 2025 — Todos los derechos reservados</small>
    </footer>

</body>
</html>
